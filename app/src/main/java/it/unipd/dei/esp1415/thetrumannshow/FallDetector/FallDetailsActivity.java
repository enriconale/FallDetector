package it.unipd.dei.esp1415.thetrumannshow.FallDetector;

import android.content.Context;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.Paint;
import android.support.v7.app.ActionBarActivity;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ImageView;
import android.widget.RelativeLayout;


public class FallDetailsActivity extends AppCompatActivity {
    public static final int NUMBER_OF_TIME_MOMENTS = 100;
    public static final int NUMBER_OF_ACCELERATION_UNITS = 35;

    private ImageView mSessionIcon;
    private RelativeLayout mGraphContainer;
    private Session mSession;
    private Fall mFall;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        getSupportActionBar().setDisplayHomeAsUpEnabled(true);
        setContentView(R.layout.activity_fall_details);

        int mSessionPositionInList = getIntent().getExtras().getInt(
                SessionsListAdapter.SESSION_DETAILS);
        mSession = SessionsLab.get(getApplicationContext()).getSessions().get(mSessionPositionInList);
        int mFallPostitionInList = getIntent().getExtras().getInt(SessionDetailsActivity
                .FALL_DETAILS);
        //mFall = mSession.getFalls().get(mFallPostitionInList);
        mSessionIcon = (ImageView)findViewById(R.id.session_icon);
        mSessionIcon.setImageResource(R.mipmap.recording_icon);
        if (SessionsLab.get(getApplicationContext()).hasRunningSession()) {
            if (mSessionPositionInList != 0) {
                mSessionIcon.setColorFilter(Color.rgb(mSession.getColor1(), mSession.getColor2(),
                        mSession.getColor3()));
            }
        } else {
            mSessionIcon.setColorFilter(Color.rgb(mSession.getColor1(), mSession.getColor2(),
                    mSession.getColor3()));
        }

        mGraphContainer = (RelativeLayout)findViewById(R.id.graph_container);
        ViewGroup.LayoutParams params = mGraphContainer.getLayoutParams();
        int height = getWindowManager().getDefaultDisplay().getHeight();
        int grapContainerHeight = height / 3;
        params.height = grapContainerHeight;

        MyView v = new MyView(getApplicationContext());
        mGraphContainer.addView(v);


    }


    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        getMenuInflater().inflate(R.menu.menu_fall_details, menu);
        return true;
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        // Handle action bar item clicks here. The action bar will
        // automatically handle clicks on the Home/Up button, so long
        // as you specify a parent activity in AndroidManifest.xml.
        int id = item.getItemId();

        switch (id) {
            case android.R.id.home:
                finish();
                return true;
        }

        return super.onOptionsItemSelected(item);
    }

    public class MyView extends View {
        protected Paint paint = new Paint();

        public MyView(Context context)
        {
            super(context);
        }

        @Override
        protected void onDraw(Canvas canvas) {

            super.onDraw(canvas);
            paint.setStyle(Paint.Style.FILL);
            paint.setColor(Color.parseColor("#000000"));
            int screenWidth = getWidth();
            int screenHeight = getHeight();
            int pixelsPerTimeUnit = getNumOfHorizontalPixelsPerTimeUnit(screenWidth);
            int pixelsPerAccUnit = getNumOfVerticalPixelsPerAccelerationUnit(screenHeight);

            int endOfPrecedentLine = screenHeight/8;
            double precedentStopY = testar[0];
            for (int i = 1; i < testar.length; i += pixelsPerTimeUnit) {
                double startY = precedentStopY;
                double stopY = testar[i];
                int offset = getPixelOffset(startY, stopY, pixelsPerAccUnit);
                canvas.drawLine(i,endOfPrecedentLine,i+pixelsPerTimeUnit,screenHeight/8 - (int)
                                startY + offset,
                        paint);
                endOfPrecedentLine = screenHeight/8 - (int)startY + offset;
                precedentStopY = stopY;
            }

            /*double startY = getHeight() - testar[1];
            double stopY = getHeight()- testar[2];
            double difference = stopY - startY;
            int pixelOffset = (int)Math.round(difference/0.01);
            canvas.drawLine(0,(int)startY,50,(int)startY + pixelOffset,
                    paint);
            int startYOnScreen2 = (int)startY + pixelOffset;
            double startY2 = stopY;
            double stopY2 = getHeight() - testar[3];
            difference = stopY2 - startY2;
            pixelOffset = (int)Math.round(difference/0.01);
            canvas.drawLine(50, startYOnScreen2, 100, (int)startY2+pixelOffset,
                    paint);*/
        }
    }

    private int getNumOfHorizontalPixelsPerTimeUnit(int screenWidth) {
        return screenWidth / NUMBER_OF_TIME_MOMENTS;
    }

    private int getNumOfVerticalPixelsPerAccelerationUnit(int screenHeight) {
        return screenHeight / NUMBER_OF_ACCELERATION_UNITS;
    }

    private int getPixelOffset(double startPointY, double stopPointY, int
            pixelsPerAccelerationUnit) {
        double difference = Math.abs(stopPointY - startPointY);
        return (int)Math.round(pixelsPerAccelerationUnit * difference);
    }

    private double[] testar = {
            12.6421117976,
            12.2332372437,
            11.9838144984,
            11.3554660774,
            10.270565065,
            9.7966475994,
            10.5119378493,
            11.2195150273,
            10.9076319797,
            9.7819112694,
            9.1099605508,
            9.0376784696,
            9.3117593731,
            9.658799395,
            9.8988792981,
            10.4448247025,
            11.351083057,
            11.9362725295,
            11.9479290827,
            12.0348265037,
            12.04241547,
            11.6531648786,
            10.5008028787,
            9.4912727426,
            8.8072509007,
            8.4364273995,
            8.7303703014,
            9.2799571427,
            9.9539384098,
            10.1291637409,
            9.7434246023,
            8.6407331199,
            7.6571354071,
            7.1237339141,
            7.0262239226,
            7.4762125081,
            8.3802922381,
            9.2510090487,
            9.6415439298,
            9.2833143549,
            9.10654037,
            8.5384955498,
            8.1075028089,
            7.6234522639,
            7.1078734375,
            8.750456389,
            11.5910340831,
            11.7768605159,
            11.7363933684,
            11.0564802609,
            11.0182899429,
            10.7165383009,
            10.5744665006,
            9.8061502139,
            8.8393667819,
            8.4769460826,
            8.5627332488,
            9.1515073319,
            10.1233424881,
            11.0284888151,
            11.6428816082,
            11.5642495332,
            11.0604496878,
            10.6478641814,
            10.0872544756,
            9.8453892892,
            10.0287996765,
            10.5245467042,
            11.1496961003,
            11.4386752088,
            11.5782491876,
            11.4467142061,
            10.5896933393,
            10.2151465123,
            10.4476188512,
            10.5332196033,
            10.0995404715,
            10.2622602467,
            10.5501375469,
            10.6795684636,
            10.9403290482,
            10.7530713762,
            10.7517029209,
            10.5110594712,
            10.4642662381,
            10.1152699392,
            9.9329995219,
            9.8122636472,
            10.0661626663,
            10.1259212921,
            10.5135753145,
            10.6279300916,
            10.8357321609,
            10.9860148528,
            11.0626890904,
            10.7436904308,
            12.4981250248,
            12.7494981911,
            12.1419051689,
            10.0697921086,
            9.3963629667,
            9.6449989203,
            9.7894299284,
            9.9374619086,
            10.4012689494,
            10.7139712082,
            10.5124043225,
            9.7087426848,
            10.1192948123,
            10.6060181021,
            10.7860723436,
            10.7651348745,
            10.5564939718,
            10.5108490028,
            11.0489487994,
            11.2351391162,
            10.975180179,
            10.3919594264,
            10.369696897,
            10.7140972712,
            10.8603019588,
            11.1715658318,
            11.4208587971,
            11.5835641549,
            11.7767791421,
            11.8926050644,
            11.7243006673,
            11.4382419994,
            11.1571802755,
            10.5604977556,
            10.5072262229,
            10.2217156537,
            9.7305597776,
            9.5337840594,
            9.4308374193,
            9.3347926568,
            9.273799466,
            9.2448059768,
            9.1981263496,
            9.174088491,
            9.1962595122,
            9.2732031744,
            9.3128956997,
            9.5501924558,
            9.9020948288,
            9.7908942306,
            9.8217855807,
            9.5742392654,
            9.3167771155,
            9.0626026473,
            8.8860866552,
            9.2046216418,
            9.4203131616,
            9.594062415,
            9.6900621643,
            9.9016381115,
            9.9775327311,
            9.8984330945,
            10.0617091495,
            10.2143456177,
            10.4475627044,
            10.7818495674,
            11.0186620093,
            11.0526343473,
            11.0429335865,
            11.1404369371,
            11.2675893054,
            11.3563637585,
            11.3689664158,
            11.3217732028,
            11.2399622882,
            11.2727267423,
            11.045771581,
            11.059945207,
            11.0816240616,
            11.0677514809,
            10.9165331026,
            10.8628385748,
            10.9378134699,
            11.1474228821,
            11.3976280078,
            11.3517900539,
            11.136720458,
            10.9759599691,
            10.9320802166,
            10.6520363284,
            10.3313015014,
            10.1491727099,
            9.9678083827,
            9.8950368676,
            9.584068302,
            9.2331893707,
            9.311779831,
            8.9871360751,
            8.4035500985,
            7.8318859693,
            7.4173227997,
            7.364213715,
            7.0012208706,
            6.1701289136,
            5.1348280832,
            4.3408250673,
            3.3472010648,
            2.2197066951,
            1.1678152545,
            0.6704479558,
            0.3243615551,
            0.2820158235,
            0.2777204779,
            0.2714157809,
            0.3108878423,
            0.2845619068,
            0.2797904591,
            0.2737092269,
            0.2655049967,
            0.2852370125,
            0.2559141164,
            0.2830369983,
            0.2845619037,
            0.2526996959,
            0.215076631,
            0.2240556735,
            0.2114692191,
            0.2071038259,
            0.1876122614,
            0.1834656361,
            0.1944092758,
            0.1547463306,
            0.1655553218,
            0.1599416309,
            0.1531847777,
            0.133384869,
            11.2689555418,
            18.4429399536,
            17.9826078333,
            22.7024141228,
            28.2227853746,
            31.3586839159,
            32.9902594157,
            31.5310676182,
            23.9336233446,
            16.0849022909,
            10.7861791712,
            7.6566896256,
            5.8889158382,
            4.8111191741,
            4.0815227212,
            3.53575665,
            3.3610496997,
            3.92778096,
            4.87569069,
            6.7686494979,
            8.9020730486,
            11.0321159253,
            12.4613398809,
            13.1914066622,
            13.2407434677,
            12.5084626399,
            11.2258736555,
            9.9496000641,
            9.0727898215,
            8.9057400581,
            9.3506094361,
            10.0750769529,
            10.6472861466,
            10.9092320889,
            10.7408474344,
            10.3043723727,
            9.8794252967,
            9.7467103803,
            9.919071981,
            10.2099245649,
            10.4396066349,
            10.5287354888,
            10.2994716339,
            10.073502072,
            9.9127145221,
            9.9610950176,
            10.1356845558,
            10.3009325535,
            10.3585389886,
            10.299233669,
            10.1342612967,
            10.0264694503,
            10.0371582985,
            10.1322872191,
            10.2035643198,
            10.2922937213,
            10.2171227556,
            10.1232424919,
            10.0893511819,
            10.094321407,
            10.1674392408,
            10.2520269038,
            10.2580048734,
            10.2144305975,
            10.1156206804,
            10.1075220701,
            10.1266858439,
            10.1748526164,
            10.223144842,
            10.2683174008,
            10.2228861878,
            10.1424523523,
            10.1437793529,
            10.1521146875,
            10.1517494124,
            10.1649751455,
            10.1880383848,
            10.1725221833,
            10.1815232152,
            10.1671322475,
            10.1545677068,
            10.1776830945,
            10.1876423347,
            10.1453867733,
            10.1757033998,
            10.1539187141,
            10.1661530224,
            10.1453867733,
            10.1453532024,
            10.1652828028,
            10.1931110553,
            10.1716708316,
            10.1780847186,
            10.1887086857,
            10.1661530224,
            10.1878119168,
            10.1743892901,
            10.1807722531,
            10.2038095091,
            10.1872081412,
            10.1462490797,
            10.3270037942,
            10.2439325991,
            10.0842700763,
            10.0710671904,
            10.1429450616,
            10.195469517,
            10.2796342434,
            10.2473956878,
            10.1320401616,
            10.0800391114,
            10.1462257756,
            10.1633102791,
            10.2184406107,
            10.2568754929,
            10.2001520759,
            10.1806352872,
            10.1045103968,
            10.1632149191,
            10.1882274897,
            10.1777164465,
            10.2090056008,
            10.1674018355,
            10.1419024429,
            9.9785841919,
            10.0302575229,
            9.8484064187,
            9.5602319935,
            9.8629651756,
            10.197186708,
            10.2522519882,
            10.4007842939,
            10.7492524903,
            10.8580353718,
            10.6749391268,
            10.368459061,
            10.1078505101,
            10.0569106698,
            10.0616328419,
            10.133369478,
            10.8642906266,
            10.9942744623,
            10.9877288252,
            10.8318262433,
            10.4474753217,
            9.9846774514,
            9.8495396394,
            9.7935547867,
            9.312859733,
            9.3065319619,
            9.4225788501,
            9.8634820131,
            9.8446029114,
            9.9967442862,
            10.2748758714,
            10.1061471749,
            9.7445399457,
            11.1284355521,
            11.4084396041,
            11.4512996126,
            10.9787763483,
            9.9089834792,
            8.7516046632,
            9.6351728519,
            10.2493245019,
            10.6865541508,
            10.8329002429,
            10.8211800344,
            10.9342261194,
            10.9946030109,
            10.8850332451,
            10.8926814383,
            10.9199336074,
            11.2170292444,
            11.5355813349,
            11.4139008807,
            11.3300517598,
            11.2390208466,
            11.6432698954,
            11.742369468,
            11.9009029695,
            12.2189489706,
            12.8111676927,
            13.0327876786,
            12.4096410993,
            11.9674895058,
            12.1550020273,
            12.2568381195,
            12.4401258211,
            12.7029440918,
            13.0090530981,
            13.5385423837,
            13.7414970713,
            13.9219421822,
            14.1810037498,
            13.9908297114,
            13.7582866976,
            13.4897389948,
            13.2386946314,
            13.2313638666,
            13.4929431018,
            13.4962423204,
            13.4761866523,
            13.4767431319,
            13.6793489748,
            13.6156827348,
            13.2709052021,
            12.8399197876,
            12.5683546254,
            12.6596530231,
            12.8529537929,
            12.9589539982,
            12.9020716092,
            12.9057982683,
            13.3813251154,
            13.9697860761,
            14.5066378761,
            14.434089963,
            14.0489783197,
            13.6745857677,
            13.4494846694,
            13.4227291751,
            13.0241400271,
            12.3468967367,
            11.3211478196,
            10.1964313433,
            9.3683493697,
            8.8242474344,
            8.2404874346,
            8.2546433237,
            7.7553806811,
            7.6833961769,
            7.7955966564,
            6.9046968267,
            5.7353229919,
            4.0322866619,
            2.4728905076,
            2.2047740162,
            2.3580458673,
            2.316716227,
            2.4457911574,
            2.9448213596,
            2.6016657913,
            1.9024396968,
            2.5086057026,
            3.6346709931,
            5.1113443231,
            4.0222689945,
            3.4680898041,
            3.1963814826,
            3.8009723868,
            4.8107093235,
            7.1926014594,
            10.7282832597,
            12.3622815952,
            14.6417107521,
            14.6375579443,
            13.7806920743,
            13.0205437188,
            12.7298252939,
            14.1006068926,
            14.4141218041,
            14.2928662832,
            14.8106015364,
            15.9164184559,
            18.0163648592,
            19.1250435707,
            19.3971666376,
            18.9344272259,
            18.0100438157,
            16.7223181585,
            15.2849075954,
            14.8652676491,
            15.2447757594,
            15.6533225436,
            15.1435768123,
            14.2853149474,
            13.3230884866,
            12.4124537338,
            11.5045810691,
            10.7265393672,
            10.7766302833,
            10.2795687331,
            9.6678111712,
            9.6501478078,
            9.7262352306,
            9.5726676516,
            9.6013168278,
            9.3928670882,
            9.1269682904,
            8.608094262,
            8.3936393098,
            8.3868251413,
            7.6511985622,
            6.8892541895,
            6.380233724,
            6.077995867,
            6.1978730363,
            6.3652719573,
            6.4003477016,
            6.4971704801,
            6.4801187824,
            6.3523328917,
            6.2020298251,
            6.0160905998,
            5.719102133,
            5.5297511016,
            5.5491171178,
            5.8330120237,
            6.2835841132,
            6.7386251149,
            7.1190745908,
            7.5225318662,
            7.8708865563,
            8.336322653,
            8.8516962068,
            9.5806358084,
            10.4762246824,
            11.1866855304,
            11.5989593047,
            11.9948928956,
            12.4283805494,
            12.8048494884,
            12.8585236309,
            12.665687776,
            12.7183567427,
            12.9949414496,
            13.5749488709,
            14.4094677507,
            14.570689315,
            13.979567495,
            13.0437336389,
            12.370715572,
            12.1918159114,
            12.0363436008,
            12.0507648313,
            11.6278634258,
            10.9859399581,
            10.1883967944,
            9.5341728356,
            9.1428390178,
            8.8142857503,
            8.4850425408,
            9.8296545226,
            10.3725901444,
            10.1767286009,
            9.691774416,
            9.3412091631,
            9.2769151841,
            9.2746338033,
            9.3502442841,
            9.5730994114,
            9.5596588369,
            9.4130816093,
            9.0183286174,
            8.7828071688,
            8.9318829256,
            9.2112803775,
            9.5510030244,
            9.7605935746,
            9.9035035976,
            10.1144319186,
            10.4323864426,
            10.7283590414,
            10.9664581402,
            11.2121287366,
            11.5210488566,
            11.71249589,
            11.6458836248,
            11.4936327757,
            11.3829237388,
            11.0275508305,
            10.9057055528,
            10.8305478188,
            10.7353758433,
            10.5037650575,
            10.1593397678,
            9.9019063245,
            9.7170551029,
            9.568849233,
            9.4690769497,
            9.6478999081,
            9.8764709682,
            10.1393089112,
            10.1054909755,
            10.0558725125,
            10.0163642702,
            9.9799616854,
            9.9806944904,
            10.1082072038,
            10.2567904725,
            10.3889699124,
            10.5365103764,
            10.5597320362,
            10.5415379383,
            10.602486597,
            10.5816399695,
            10.4987827685,
            10.6276049392,
            10.3175794599,
            9.7165444264,
            9.4558132971,
            9.4981900399,
            9.752535146,
            10.0918057025,
            10.4356265351,
            10.7200370796,
            10.273532902

    };
}
